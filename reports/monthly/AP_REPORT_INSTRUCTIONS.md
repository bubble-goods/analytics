# Accounts Payable Report - Implementation Instructions

## Purpose
This report provides a comprehensive view of what Bubble Goods owes to each seller/brand for a given month, including:
- Total GMV per brand
- Commission breakdown (35% or 25%)
- Refunds and damages to deduct
- Payments already made
- Outstanding balances

## Metabase Implementation Steps

### 1. Create the Question/Card

1. **Navigate to Metabase**: Go to https://mbase.bubblegoods.com
2. **New Question**: Click "New" â†’ "Question"
3. **Choose Database**: Select "Bubble Production Read Replica" (Database ID: 2)
4. **Native Query**: Choose "Native query" (SQL)
5. **Paste Query**: Copy the contents of `accounts_payable_final.sql`

### 2. Set up Parameters

The query uses two date parameters that need to be configured:

1. **start_date Parameter**:
   - Name: `start_date` 
   - Type: Date
   - Default: First day of current month
   - Label: "Month Start Date"

2. **end_date Parameter**:
   - Name: `end_date`
   - Type: Date  
   - Default: First day of next month
   - Label: "Month End Date"

### 3. Configure Display Settings

1. **Column Formatting**:
   - All monetary columns should be formatted as Currency (USD)
   - "Commission Rate" as Text/Plain text
   - "Brand Name" as Text/Plain text

2. **Visualization**:
   - Default view: Table
   - Optional: Add summary metrics at bottom (totals)

### 4. Save and Organize

1. **Save Settings**:
   - Title: "Accounts Payable by Brand - Monthly"
   - Description: "Monthly AP report showing GMV, commissions, refunds, payments, and outstanding balances per seller/brand"

2. **Collection**: Save to "Financial Reports" or "Seller Management" collection

### 5. Usage Instructions

**To run the report for a specific month:**
1. Set `start_date` to the first day of the month (e.g., 2024-07-01)
2. Set `end_date` to the first day of the next month (e.g., 2024-08-01)
3. Click "Get Answer"

**Key Columns Explained:**
- **Total GMV**: All revenue generated by the brand in the month
- **Bubble Goods Revenue**: Our commission (35% or 25% of GMV)
- **Refunds/Damages**: Deductions from seller payout due to refunds
- **Total AP Owed**: What we owe the seller for this month (GMV minus our commission minus refunds)
- **Paid This Month**: Actual payments made to the seller in this month
- **Outstanding Balance**: Total amount still owed (cumulative)

## Data Sources

- **sellers**: Brand information and commission rates
- **orders**: Transaction data and GMV 
- **refunds**: Refund amounts tied to orders
- **seller_payouts**: Payment history to sellers

## Data Quality Notes

- Only includes orders with financial_status: 'paid', 'partially_paid', 'authorized'
- Excludes cancelled orders
- Only shows active sellers
- Refunds are attributed to the month when the original order was placed
- Outstanding balance includes all historical data, not just the selected month

## Troubleshooting

**Common Issues:**
- Missing sellers: Check if they have any GMV or payments in the selected month
- Negative balances: May indicate overpayments or data issues
- Zero values: Normal for sellers with no activity in the month

**Data Validation:**
- Total GMV should match other GMV reports for the same period
- Sum of "Bubble Goods Revenue" should equal total commission for the month
- Cross-reference payment amounts with Stripe payout data